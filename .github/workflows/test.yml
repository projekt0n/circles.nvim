name: test

on:
  push:
    branches: [main]
  pull_request:
    paths-ignore:
      - "**.md"
      - LICENSE
    branches: [main]

jobs:
  test:
    strategy:
      fail-fast: true
      matrix:
        neovim_tag: ["v0.5.0", "v0.5.1", "v0.6.0", "v0.6.1", "v0.7.0"]
        os: [macos-latest, ubuntu-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup Neovim
        uses: MunifTanjim/setup-neovim-action@v1
        with:
          tag: ${{ matrix.neovim_tag }}
      - name: Prepare Neovim
        run: |
          nvim --version
          git clone --depth 1 https://github.com/nvim-lua/plenary.nvim ~/.local/share/nvim/site/pack/vendor/start/plenary.nvim
          git clone --depth 1 https://github.com/kyazdani42/nvim-web-devicons ~/.local/share/nvim/site/pack/vendor/start/nvim-web-devicons
          ln -s $(pwd) ~/.local/share/nvim/site/pack/vendor/start
      - name: Run Tests
        run: make test
